<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="robots" content="noindex, nofollow" />
  <title>Blockchain Payments ‚Äî Guest</title>
  <meta name="description" content="Select your tip, scan the QR, and send your crypto payment securely." />
  <style>
    :root {
      --bg-light: #d9d9d9;
      --bg-dark: #c3c3c3;
      --panel-light: #f5f5f5;
      --panel-dark: #6f6f6f;
      --panel-mid: #e0e0e0;
      --text: #000;
      --muted: #303030;
      --highlight: #ffffff;
      --shadow: #7d7d7d;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    html, body {
      height: 100%;
      font-family: "Chicago", "Charcoal", "Geneva", "Segoe UI", sans-serif;
      background:
        linear-gradient(90deg, var(--bg-light) 0, var(--bg-light) 50%, var(--bg-dark) 50%, var(--bg-dark) 100%);
      background-size: 8px 8px;
      color: var(--text);
    }

    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 24px;
      gap: 16px;
    }

    .desktop {
      width: min(960px, 100%);
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .menu-bar {
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 6px 12px;
      background: linear-gradient(#6d6d6d, #4c4c4c);
      color: #fff;
      font-size: 14px;
      letter-spacing: 0.3px;
      border: 1px solid #000;
      box-shadow: inset 1px 1px var(--highlight), inset -1px -1px var(--shadow);
    }

    .menu-item { display: inline-flex; gap: 6px; align-items: center; }
    .menu-apple { font-size: 18px; margin-right: 8px; }

    .window {
      margin: 24px auto 0;
      width: min(640px, 95%);
      background: var(--panel-light);
      border: 1px solid #000;
      box-shadow: inset 1px 1px var(--highlight), inset -1px -1px var(--shadow);
    }

    .title-bar {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      background: linear-gradient(#898989, #5c5c5c);
      color: #fff;
      border-bottom: 1px solid #000;
      box-shadow: inset 1px 1px #bbb, inset -1px -1px #333;
    }

    .window-controls { display: inline-flex; gap: 4px; }

    .window-controls span {
      display: inline-block;
      width: 10px;
      height: 10px;
      background: #fff;
      border: 1px solid #000;
      box-shadow: inset 1px 1px var(--highlight), inset -1px -1px var(--shadow);
    }

    .title-text { flex: 1; font-weight: bold; letter-spacing: 0.4px; text-align: center; }

    .window-body {
      padding: 22px 26px 28px;
    }

    header.window-header {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 24px;
    }

    .title {
      font-size: 18px;
      font-weight: bold;
      letter-spacing: 1px;
    }

    .tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .tag {
      padding: 3px 10px;
      border: 1px solid #000;
      background: var(--panel-mid);
      box-shadow: inset 1px 1px var(--highlight), inset -1px -1px var(--shadow);
      font-size: 13px;
    }

    .beta-note {
      margin-bottom: 16px;
      padding: 10px 12px;
      border: 1px solid #000;
      background: var(--panel-light);
      box-shadow: inset 1px 1px var(--highlight), inset -1px -1px var(--shadow);
      font-weight: bold;
      text-align: center;
    }

    .nav-home {
      display: flex;
      margin-bottom: 16px;
    }

    .hint {
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 10px;
    }

    .percent-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }

    @media (min-width: 640px) {
      .percent-grid { grid-template-columns: repeat(4, 1fr); }
    }

    button, input, select { font-family: inherit; }

    .pill {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 14px 10px;
      border: 1px solid #000;
      background: var(--panel-light);
      box-shadow:
        inset 1px 1px var(--highlight),
        inset -1px -1px var(--shadow),
        2px 2px 0 #000;
      cursor: pointer;
      transition: none;
    }

    .pill:hover {
      box-shadow:
        inset -1px -1px var(--highlight),
        inset 1px 1px var(--shadow),
        2px 2px 0 #000;
    }

    .pill.active {
      background: var(--panel-mid);
      font-weight: bold;
    }

    .pill .pct { font-size: 20px; }
    .pill .approx { font-size: 11px; color: var(--muted); margin-top: 4px; }

    .custom {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-top: 16px;
      flex-wrap: wrap;
    }

    input[type="number"] {
      width: 120px;
      padding: 8px 10px;
      border: 1px solid #000;
      background: var(--panel-light);
      box-shadow: inset 1px 1px var(--highlight), inset -1px -1px var(--shadow);
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 9px 16px;
      border: 1px solid #000;
      background: var(--panel-light);
      box-shadow:
        inset 1px 1px var(--highlight),
        inset -1px -1px var(--shadow),
        2px 2px 0 #000;
      cursor: pointer;
      font-size: 13px;
      text-decoration: none;
      color: inherit;
      transition: none;
    }

    .btn:hover {
      box-shadow:
        inset -1px -1px var(--highlight),
        inset 1px 1px var(--shadow),
        2px 2px 0 #000;
    }

    .btn.primary { background: var(--panel-mid); font-weight: bold; }

    .summary {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin: 20px 0;
    }

    .kpi {
      padding: 12px 14px;
      border: 1px solid #000;
      background: var(--panel-light);
      box-shadow: inset 1px 1px var(--highlight), inset -1px -1px var(--shadow);
      text-align: center;
    }

    .kpi b { display: block; font-size: 11px; color: var(--muted); letter-spacing: 0.5px; }
    .kpi span { font-size: 18px; font-weight: bold; }

    .qrWrap { text-align: center; display: none; margin-top: 20px; }

    .qrBox {
      display: flex;
      align-items: center;
      justify-content: center;
      background: #fff;
      border: 1px solid #000;
      box-shadow: inset 1px 1px var(--highlight), inset -1px -1px var(--shadow);
      width: 260px;
      height: 260px;
      margin: 0 auto;
    }

    canvas { width: 100% !important; height: 100% !important; }

    .hint-scan {
      font-size: 12px;
      color: var(--muted);
      margin-top: 10px;
      text-align: center;
      line-height: 1.4;
    }

    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 14px;
      justify-content: center;
    }

    .uri {
      color: var(--muted);
      font-size: 12px;
      word-break: break-all;
      margin-top: 6px;
    }

    .divider { height: 1px; background: #000; margin: 24px 0; }

    footer {
      font-size: 12px;
      color: var(--muted);
      line-height: 1.4;
      text-align: center;
    }

    footer a {
      color: inherit;
      text-decoration: none;
      font-weight: bold;
    }

    footer a:hover { text-decoration: underline; }

    @media (max-width: 540px) {
      body { padding: 16px; }
      .menu-bar { font-size: 12px; gap: 12px; }
      .window { width: 100%; margin-top: 12px; }
      .window-body { padding: 18px; }
      .summary { grid-template-columns: 1fr; }
      .custom { flex-direction: column; align-items: flex-start; }
    }
  </style>
</head>

<body>
  <div class="desktop">
    <div class="menu-bar">
      <span class="menu-item menu-apple">Ô£ø</span>
      <span class="menu-item">open source tools for hospitality workers</span>
    </div>

    <div class="window">
      <div class="title-bar">
        <div class="window-controls">
          <span></span><span></span><span></span>
        </div>
        <span class="title-text">Guest Tipping Console</span>
      </div>
      <div class="window-body">
        <div class="nav-home">
          <a class="btn" href="index.html">‚Üê Home</a>
        </div>
        <header class="window-header">
          <div class="title">BLOCKCHAIN PAYMENTS</div>
          <div class="tags">
            <span class="tag" id="tagCrypto">‚Äî</span>
            <span class="tag" id="tagFiat">‚Äî</span>
            <span class="tag" id="tagAddr">‚Äî</span>
          </div>
        </header>

        <p class="beta-note">This console is a beta build that is still being polished.</p>

        <section>
          <div class="hint">Select your tip percentage</div>
          <div class="percent-grid" id="percentGroup">
            <button class="pill" data-p="5"><div class="pct">5%</div><div class="approx">‚âà ‚Äî</div></button>
            <button class="pill" data-p="10"><div class="pct">10%</div><div class="approx">‚âà ‚Äî</div></button>
            <button class="pill" data-p="15"><div class="pct">15%</div><div class="approx">‚âà ‚Äî</div></button>
            <button class="pill" data-p="20"><div class="pct">20%</div><div class="approx">‚âà ‚Äî</div></button>
          </div>

          <div class="custom">
            <span class="hint">or enter a custom %</span>
            <input id="customP" type="number" step="0.5" min="0" placeholder="Custom %">
            <button class="btn" id="applyCustom">Apply</button>
          </div>

          <div class="summary">
            <div class="kpi"><b>Bill</b><span id="billFiat">‚Äî</span></div>
            <div class="kpi"><b>Tip</b><span id="tipFiat">‚Äî</span></div>
          </div>

          <div class="qrWrap" id="qrWrap">
            <div class="qrBox" id="qrBox"><canvas id="qrCanvas"></canvas></div>
            <div class="hint-scan">
              Live rates via Coinbase. Always verify the amount in your wallet before sending.
            </div>
            <div class="actions">
              <a class="btn primary" id="openWallet" target="_blank" rel="noopener noreferrer">Open Wallet</a>
              <button class="btn" id="copyLink">Copy Link</button>
              <button class="btn" id="copyAmount">Copy Amount</button>
            </div>
            <div class="uri" id="uriPreview">‚Äî</div>
          </div>
        </section>

        <div class="divider"></div>
        <footer>
          <p>
            <a href="https://www.reddit.com/u/Square_Ad_7551" target="_blank">@Square_Ad_7551</a> ‚Äî
            Open-source under the
            <a href="https://www.gnu.org/licenses/agpl-3.0.html" target="_blank">AGPL-3.0 License</a>.<br>
            Feel free to reuse or remix this code as long as your project stays open-source too üíõ
          </p>
        </footer>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/qrcode@latest/build/qrcode.min.js"></script>
  <script>
    const $ = s => document.querySelector(s)
    const qs = new URLSearchParams(location.search)
    const crypto = (qs.get('crypto') || 'ETH').toUpperCase()
    const fiat   = (qs.get('fiat') || 'USD').toUpperCase()
    const addr   = (qs.get('addr') || '').trim()
    const bill   = parseFloat(qs.get('bill') || '0')

    $('#tagCrypto').textContent = crypto
    $('#tagFiat').textContent   = fiat
    $('#tagAddr').textContent   = addr ? `‚Ä¶${addr.slice(-6)}` : '‚Äî'
    $('#billFiat').textContent  = bill > 0 ? `${bill.toFixed(2)} ${fiat}` : '‚Äî'

    function refreshApprox() {
      document.querySelectorAll('.pill').forEach(btn => {
        const p = parseFloat(btn.dataset.p)
        const approx = bill > 0 ? (bill * p / 100).toFixed(2) : '‚Äî'
        btn.querySelector('.approx').textContent = `‚âà ${approx} ${fiat}`
      })
    }
    refreshApprox()

    async function renderForPercent(p) {
      const tipFiat = bill * p / 100
      $('#tipFiat').textContent = `${tipFiat.toFixed(2)} ${fiat}`

      try {
        const rateRes = await fetch(`https://api.coinbase.com/v2/exchange-rates?currency=${crypto}`)
        const rateJson = await rateRes.json()
        const rate = parseFloat(rateJson.data.rates[fiat])
        const tipCrypto = tipFiat / rate
        const uri = `${crypto.toLowerCase()}:${addr}?amount=${tipCrypto}`

        $('#uriPreview').textContent = uri
        QRCode.toCanvas($('#qrCanvas'), uri, { width: 256 })

        $('#openWallet').href = uri
        $('#copyLink').onclick  = () => navigator.clipboard.writeText(uri)
        $('#copyAmount').onclick = () => navigator.clipboard.writeText(`${tipFiat.toFixed(2)} ${fiat}`)
        $('#qrWrap').style.display = 'block'
      } catch (e) {
        console.error(e)
        alert('Could not fetch live rate ‚Äî please retry.')
      }
    }

    document.querySelectorAll('.pill').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.pill').forEach(b => b.classList.remove('active'))
        btn.classList.add('active')
        renderForPercent(parseFloat(btn.dataset.p))
      })
    })

    $('#applyCustom').addEventListener('click', () => {
      const pct = parseFloat($('#customP').value)
      if (!(pct >= 0)) { alert('Enter a valid percentage.'); return }
      document.querySelectorAll('.pill').forEach(b => b.classList.remove('active'))
      renderForPercent(pct)
    })
  </script>
</body>
</html>
